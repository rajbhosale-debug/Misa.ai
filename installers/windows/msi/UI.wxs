<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">

  <!-- Custom UI Dialogs for MISA.AI Installer -->

  <Fragment>

    <!-- Welcome Dialog -->
    <UI>
      <Dialog Id="MisaWelcomeDlg" Width="370" Height="270" Title="[ProductName] Setup" NoMinimize="yes">
        <Control Id="Next" Type="PushButton" X="236" Y="243" Width="56" Height="17" Default="yes" Text="!(loc.WixUINext)" />
        <Control Id="Cancel" Type="PushButton" X="304" Y="243" Width="56" Height="17" Cancel="yes" Text="!(loc.WixUICancel)">
          <Publish Event="SpawnDialog" Value="CancelDlg">1</Publish>
        </Control>
        <Control Id="Bitmap" Type="Bitmap" X="0" Y="0" Width="370" Height="234" TabSkip="no" Text="!(loc.WixUIBannerBmp)" />
        <Control Id="Back" Type="PushButton" X="180" Y="243" Width="56" Height="17" Disabled="yes" Text="!(loc.WixUIBack)" />
        <Control Id="Description" Type="Text" X="135" Y="25" Width="220" Height="60" Transparent="yes" NoPrefix="yes">
          <Text>The MISA.AI Setup Wizard will install MISA.AI on your computer. Click Next to continue or Cancel to exit the Setup Wizard.</Text>
        </Control>
        <Control Id="Title" Type="Text" X="135" Y="15" Width="220" Height="15" Transparent="yes" NoPrefix="yes">
          <Text>{\WixUI_Font_Title}Welcome to the MISA.AI Setup Wizard</Text>
        </Control>
        <Control Id="InfoText" Type="Text" X="135" Y="70" Width="220" Height="60" Transparent="yes" NoPrefix="yes">
          <Text>MISA.AI - Privacy-First AI Assistant

Features:
• Local AI model processing
• Hybrid cloud integration
• Multi-device synchronization
• Privacy-first design
• Voice and text interaction

System Requirements:
• Windows 10/11 (64-bit)
• 4GB RAM minimum, 8GB recommended
• 10GB available disk space
• Internet connection for models</Text>
        </Control>
      </Dialog>

      <!-- System Requirements Check Dialog -->
      <Dialog Id="MisaSystemCheckDlg" Width="370" Height="270" Title="[ProductName] System Requirements" NoMinimize="yes">
        <Control Id="Next" Type="PushButton" X="236" Y="243" Width="56" Height="17" Default="yes" Text="!(loc.WixUINext)" />
        <Control Id="Cancel" Type="PushButton" X="304" Y="243" Width="56" Height="17" Cancel="yes" Text="!(loc.WixUICancel)">
          <Publish Event="SpawnDialog" Value="CancelDlg">1</Publish>
        </Control>
        <Control Id="Back" Type="PushButton" X="180" Y="243" Width="56" Height="17" Text="!(loc.WixUIBack)" />
        <Control Id="Bitmap" Type="Bitmap" X="0" Y="0" Width="370" Height="234" TabSkip="no" Text="!(loc.WixUIBannerBmp)" />
        <Control Id="Title" Type="Text" X="135" Y="15" Width="220" Height="15" Transparent="yes" NoPrefix="yes">
          <Text>{\WixUI_Font_Title}System Requirements Check</Text>
        </Control>

        <!-- System Requirements Display -->
        <Control Id="ReqOS" Type="Text" X="135" Y="40" Width="220" Height="15" Transparent="yes" NoPrefix="yes">
          <Text>Operating System: [MISA_OSStatus]</Text>
        </Control>
        <Control Id="ReqRAM" Type="Text" X="135" Y="60" Width="220" Height="15" Transparent="yes" NoPrefix="yes">
          <Text>Memory: [MISA_RAMStatus]</Text>
        </Control>
        <Control Id="ReqDisk" Type="Text" X="135" Y="80" Width="220" Height="15" Transparent="yes" NoPrefix="yes">
          <Text>Disk Space: [MISA_DiskStatus]</Text>
        </Control>
        <Control Id="ReqArch" Type="Text" X="135" Y="100" Width="220" Height="15" Transparent="yes" NoPrefix="yes">
          <Text>Architecture: [MISA_ArchStatus]</Text>
        </Control>
        <Control Id="ReqNet" Type="Text" X="135" Y="120" Width="220" Height="15" Transparent="yes" NoPrefix="yes">
          <Text>Network: [MISA_NetStatus]</Text>
        </Control>

        <!-- Status Messages -->
        <Control Id="StatusText" Type="Text" X="135" Y="160" Width="220" Height="30" Transparent="yes" NoPrefix="yes">
          <Text>[MISA_CheckMessage]</Text>
        </Control>

        <!-- Warning/Error Message -->
        <Control Id="WarningText" Type="Text" X="135" Y="195" Width="220" Height="40" Transparent="yes" NoPrefix="yes" Hidden="yes">
          <Text>[MISA_WarningMessage]</Text>
        </Control>
      </Dialog>

      <!-- Installation Type Dialog -->
      <Dialog Id="MisaInstallTypeDlg" Width="370" Height="270" Title="[ProductName] Installation Type" NoMinimize="yes">
        <Control Id="Next" Type="PushButton" X="236" Y="243" Width="56" Height="17" Default="yes" Text="!(loc.WixUINext)" />
        <Control Id="Cancel" Type="PushButton" X="304" Y="243" Width="56" Height="17" Cancel="yes" Text="!(loc.WixUICancel)">
          <Publish Event="SpawnDialog" Value="CancelDlg">1</Publish>
        </Control>
        <Control Id="Back" Type="PushButton" X="180" Y="243" Width="56" Height="17" Text="!(loc.WixUIBack)" />
        <Control Id="Bitmap" Type="Bitmap" X="0" Y="0" Width="370" Height="234" TabSkip="no" Text="!(loc.WixUIBannerBmp)" />
        <Control Id="Title" Type="Text" X="135" Y="15" Width="220" Height="15" Transparent="yes" NoPrefix="yes">
          <Text>{\WixUI_Font_Title}Choose Installation Type</Text>
        </Control>

        <!-- Installation Type Selection -->
        <Control Id="TypicalRadio" Type="RadioButtonGroup" X="135" Y="50" Width="220" Height="60" Property="INSTALLTYPE">
          <RadioButtonGroup Property="INSTALLTYPE">
            <RadioButton Value="Typical" X="0" Y="0" Width="220" Height="15" Text="Typical (Recommended)" />
            <RadioButton Value="Custom" X="0" Y="20" Width="220" Height="15" Text="Custom" />
            <RadioButton Value="Complete" X="0" Y="40" Width="220" Height="15" Text="Complete" />
          </RadioButtonGroup>
        </Control>

        <!-- Installation Type Description -->
        <Control Id="TypicalDesc" Type="Text" X="145" Y="115" Width="210" Height="30" Transparent="yes" NoPrefix="yes">
          <Text>Installs the most common program features. Recommended for most users.</Text>
        </Control>
        <Control Id="CustomDesc" Type="Text" X="145" Y="135" Width="210" Height="30" Transparent="yes" NoPrefix="yes">
          <Text>Allows users to choose which program features will be installed and where they will be installed.</Text>
        </Control>
        <Control Id="CompleteDesc" Type="Text" X="145" Y="155" Width="210" Height="30" Transparent="yes" NoPrefix="yes">
          <Text>All program features will be installed. Requires the most disk space.</Text>
        </Control>

        <!-- Feature List for Custom Installation -->
        <Control Id="FeatureList" Type="Text" X="20" Y="200" Width="330" Height="30" Transparent="yes" NoPrefix="yes">
          <Text>Typical includes: MISA.AI Application + Kernel + Basic AI Models
Custom includes: Docker Desktop + Ollama + Service Integration
Complete includes: All features + Additional AI Models</Text>
        </Control>
      </Dialog>

      <!-- Model Selection Dialog -->
      <Dialog Id="MisaModelSelectDlg" Width="370" Height="270" Title="[ProductName] AI Model Selection" NoMinimize="yes">
        <Control Id="Next" Type="PushButton" X="236" Y="243" Width="56" Height="17" Default="yes" Text="!(loc.WixUINext)" />
        <Control Id="Cancel" Type="PushButton" X="304" Y="243" Width="56" Height="17" Cancel="yes" Text="!(loc.WixUICancel)">
          <Publish Event="SpawnDialog" Value="CancelDlg">1</Publish>
        </Control>
        <Control Id="Back" Type="PushButton" X="180" Y="243" Width="56" Height="17" Text="!(loc.WixUIBack)" />
        <Control Id="Bitmap" Type="Bitmap" X="0" Y="0" Width="370" Height="234" TabSkip="no" Text="!(loc.WixUIBannerBmp)" />
        <Control Id="Title" Type="Text" X="135" Y="15" Width="220" Height="15" Transparent="yes" NoPrefix="yes">
          <Text>{\WixUI_Font_Title}Select AI Models</Text>
        </Control>

        <!-- Model Selection Checkboxes -->
        <Control Id="MixtralCheck" Type="CheckBox" X="135" Y="40" Width="220" Height="15" Property="INSTALL_MIXTRAL" CheckBoxValue="1">
          <Text>Mixtral (4.7GB) - General purpose AI</Text>
        </Control>
        <Control Id="CodeLlamaCheck" Type="CheckBox" X="135" Y="60" Width="220" Height="15" Property="INSTALL_CODELLAMA" CheckBoxValue="1">
          <Text>CodeLlama (3.8GB) - Code generation</Text>
        </Control>
        <Control Id="WizardCoderCheck" Type="CheckBox" X="135" Y="80" Width="220" Height="15" Property="INSTALL_WIZARDCODER" CheckBoxValue="1">
          <Text>WizardCoder (3.2GB) - Advanced coding</Text>
        </Control>
        <Control Id="DolphinCheck" Type="CheckBox" X="135" Y="100" Width="220" Height="15" Property="INSTALL_DOLPHIN" CheckBoxValue="1">
          <Text>Dolphin Mistral (2.3GB) - Conversational AI</Text>
        </Control>

        <!-- Model Information -->
        <Control Id="ModelInfo" Type="Text" X="20" Y="130" Width="330" Height="40" Transparent="yes" NoPrefix="yes">
          <Text>Note: Models will be downloaded during installation.
Total download size will vary based on selection.
You can download additional models later from within MISA.AI.</Text>
        </Control>

        <!-- Storage Requirements -->
        <Control Id="StorageReq" Type="Text" X="135" Y="180" Width="220" Height="15" Transparent="yes" NoPrefix="yes">
          <Text>Required disk space: [MODEL_STORAGE_SIZE]</Text>
        </Control>

        <!-- Download Time Estimate -->
        <Control Id="DownloadTime" Type="Text" X="135" Y="200" Width="220" Height="15" Transparent="yes" NoPrefix="yes">
          <Text>Estimated download time: [MODEL_DOWNLOAD_TIME]</Text>
        </Control>
      </Dialog>

      <!-- Progress Dialog -->
      <Dialog Id="MisaProgressDlg" Width="370" Height="270" Title="[ProductName] Setup" NoMinimize="yes">
        <Control Id="Cancel" Type="PushButton" X="304" Y="243" Width="56" Height="17" Cancel="yes" Text="!(loc.WixUICancel)">
          <Publish Event="SpawnDialog" Value="CancelDlg">1</Publish>
        </Control>
        <Control Id="BannerBitmap" Type="Bitmap" X="0" Y="0" Width="370" Height="44" TabSkip="no" Text="!(loc.WixUIBannerBmp)" />
        <Control Id="Back" Type="PushButton" X="156" Y="243" Width="56" Height="17" Disabled="yes" Text="!(loc.WixUIBack)" />
        <Control Id="Next" Type="PushButton" X="236" Y="243" Width="56" Height="17" Disabled="yes" Text="!(loc.WixUINext)" />
        <Control Id="ActionText" Type="Text" X="135" Y="70" Width="220" Height="20">
          <Text>Please wait while MISA.AI configures your system...</Text>
        </Control>
        <Control Id="ProgressBar" Type="ProgressBar" X="20" Y="65" Width="330" Height="10" ProgressBlocks="yes" Text="Progress" />
        <Control Id="StatusLabel" Type="Text" X="20" Y="45" Width="330" Height="15" Transparent="yes" NoPrefix="yes">
          <Text>Status: [MISA_InstallStatus]</Text>
        </Control>
        <Control Id="BannerLine" Type="Line" X="0" Y="44" Width="370" Height="0" />
        <Control Id="BottomLine" Type="Line" X="0" Y="234" Width="370" Height="0" />

        <!-- Detailed Progress Information -->
        <Control Id="CurrentAction" Type="Text" X="20" Y="100" Width="330" Height="15" Transparent="yes" NoPrefix="yes">
          <Text>[MISA_CurrentAction]</Text>
        </Control>
        <Control Id="ElapsedTime" Type="Text" X="20" Y="120" Width="150" Height="15" Transparent="yes" NoPrefix="yes">
          <Text>Elapsed: [MISA_ElapsedTime]</Text>
        </Control>
        <Control Id="TimeRemaining" Type="Text" X="200" Y="120" Width="150" Height="15" Transparent="yes" NoPrefix="yes">
          <Text>Remaining: [MISA_TimeRemaining]</Text>
        </Control>

        <!-- Progress Steps -->
        <Control Id="ProgressSteps" Type="Text" X="20" Y="145" Width="330" Height="70" Transparent="yes" NoPrefix="yes">
          <Text>Installation Progress:
1. ✓ Copying application files
2. ✓ Installing dependencies
3. ✓ Configuring Windows service
4. ✓ Setting up firewall rules
5. [MISA_CurrentStep] Downloading AI models...
6. ⭕ Creating desktop shortcuts
7. ⭕ Finalizing configuration</Text>
        </Control>
      </Dialog>

      <!-- Completion Dialog -->
      <Dialog Id="MisaFinishDlg" Width="370" Height="270" Title="[ProductName] Setup Complete" NoMinimize="yes">
        <Control Id="Finish" Type="PushButton" X="236" Y="243" Width="56" Height="17" Default="yes" Text="!(loc.WixUIFinish)" />
        <Control Id="Cancel" Type="PushButton" X="304" Y="243" Width="56" Height="17" Disabled="yes" Text="!(loc.WixUICancel)" />
        <Control Id="Bitmap" Type="Bitmap" X="0" Y="0" Width="370" Height="234" TabSkip="no" Text="!(loc.WixUIBannerBmp)" />
        <Control Id="Back" Type="PushButton" X="180" Y="243" Width="56" Height="17" Disabled="yes" Text="!(loc.WixUIBack)" />
        <Control Id="Description" Type="Text" X="135" Y="25" Width="220" Height="15" Transparent="yes" NoPrefix="yes">
          <Text>Click the Finish button to exit the Setup Wizard.</Text>
        </Control>
        <Control Id="Title" Type="Text" X="135" Y="15" Width="220" Height="15" Transparent="yes" NoPrefix="yes">
          <Text>{\WixUI_Font_Title}Completing the MISA.AI Setup Wizard</Text>
        </Control>

        <!-- Success Message -->
        <Control Id="SuccessText" Type="Text" X="20" Y="50" Width="330" Height="40" Transparent="yes" NoPrefix="yes">
          <Text>MISA.AI has been successfully installed on your computer!

• Application installed in: [INSTALLFOLDER]
• Configuration files: [DATADIR]
• AI models installed and ready
• Windows service configured</Text>
        </Control>

        <!-- Launch Application Checkbox -->
        <Control Id="LaunchApp" Type="CheckBox" X="20" Y="100" Width="330" Height="15" Property="WIXUI_EXITDIALOGOPTIONALCHECKBOX" CheckBoxValue="1">
          <Text>Launch MISA.AI when setup exits</Text>
        </Control>

        <!-- Additional Options -->
        <Control Id="ViewDocs" Type="CheckBox" X="20" Y="120" Width="330" Height="15" Property="VIEW_DOCUMENTATION" CheckBoxValue="1">
          <Text>View user documentation</Text>
        </Control>
        <Control Id="JoinCommunity" Type="CheckBox" X="20" Y="140" Width="330" Height="15" Property="JOIN_COMMUNITY" CheckBoxValue="1">
          <Text>Visit MISA.AI community website</Text>
        </Control>

        <!-- Support Information -->
        <Control Id="SupportInfo" Type="Text" X="20" Y="165" Width="330" Height="40" Transparent="yes" NoPrefix="yes">
          <Text>Need Help?
• Support: https://support.misa.ai
• Documentation: https://docs.misa.ai
• Community: https://community.misa.ai
• Report Issues: https://github.com/misa-ai/misa.ai/issues</Text>
        </Control>
      </Dialog>

    </UI>

    <!-- UI References -->
    <UIRef Id="MisaUI" />

    <!-- Custom Actions for Progress Dialog -->
    <Binary Id="CustomActionsDLL" SourceFile="CustomActions.dll" />

    <CustomAction Id="SetInstallProgress"
                 BinaryKey="CustomActionsDLL"
                 DllEntry="SetInstallProgress"
                 Execute="immediate" />

    <CustomAction Id="UpdateProgressSteps"
                 BinaryKey="CustomActionsDLL"
                 DllEntry="UpdateProgressSteps"
                 Execute="immediate" />

  </Fragment>

</Wix>